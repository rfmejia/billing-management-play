<md-toolbar>
    <div class="md-toolbar-tools" layout="row" layout-align="start center">
        <button hide-gt-md class="menuBtn menuBtn-hamburger" toggle-side-nav>
            <span class="visually-hidden">Menu</span>
        </button>
        <h3 flex class="toolbar-title">{{updateCtrl.documentTitle}}</h3>

        <div>
            <md-button ng-if="!updateCtrl.isDisabled"
                       class="options toolbar-text no-uppercase"
                       ng-show="!drafts.isDisabled"
                       remove-focus
                       ng-click="updateCtrl.onUnlinkClicked()">
                <span><i class="fa fa-chain-broken iconed-text"></i>Unlock</span>
            </md-button>
            <div ng-if="updateCtrl.isDisabled">
                <span class="toolbar-text"><i class="iconed-text fa fa-lock"></i>Assigned to {{updateCtrl.assigned.fullName}}</span>
            </div>
        </div>
    </div>
</md-toolbar>

<md-content layout="column" flex class="md-padding content reports">
    <div ng-if="stateIsLoading" layout="column" layout-align="center-center" flex="10">
        <md-progress-linear md-mode="indeterminate"></md-progress-linear>
    </div>
    <div flex class="max-width">
        <form name="updateForm">
            <fieldset ng-disabled="updateCtrl.isDisabled">
                <md-card class="reports">
                    <md-card-content>
                        <div flex ng-repeat="section in updateCtrl.payments.sections">
                            <h3>{{section.name | capitalize}}</h3>

                            <div layout-md="column" layout-gt-md="row" flex>
                                <md-input-container flex>
                                    <label>Total</label> <input type="text"
                                                                disabled
                                                                ng-model="section.amounts.total"
                                                                fcsa-number>
                                </md-input-container>
                                <md-input-container flex>
                                    <label>Unpaid</label> <input type="text"
                                                                 disabled
                                                                 ng-model="section.amounts.unpaid"
                                                                 fcsa-number>
                                </md-input-container>
                                <md-input-container flex ng-form="pseudoForm">
                                    <label>Paid</label> <input type="number"
                                                               min="0"
                                                               max="{{section.amounts.total}}"
                                                               name="paid"
                                                               step="0.01"
                                                               ng-model="section.amounts.paid">

                                    <div ng-messages="pseudoForm.paid.$error">
                                        <div ng-message="min">No negative values please</div>
                                        <div ng-message="max">Payment exceeds charged amount</div>
                                    </div>
                                </md-input-container>
                            </div>
                        </div>
                    </md-card-content>
                </md-card>
            </fieldset>
            <md-card>
                <md-card-content>
                    <div class="md-actions" layout="row" layout-align="start center">
                        <md-button
                                class="no-uppercase"
                                remove-focus
                                ng-click="updateCtrl.onCancelClicked()">
                            <span><i class="fa fa-times iconed-text"></i>Cancel</span>
                        </md-button>

                        <div flex>
                            <md-button
                                    ng-if="!updateCtrl.isDisabled"
                                    remove-focus
                                    type="submit"
                                    class="pull-right no-uppercase md-primary"
                                    ng-click="updateCtrl.onFullPayClicked()">
                                <span>Full payment <i class="fa fa-check iconed-text"></i></span>
                                <md-tooltip md-delay="200">Auto-fills all fields and saves.</md-tooltip>
                            </md-button>
                            <md-button
                                    ng-if="!updateCtrl.isDisabled"
                                    remove-focus
                                    type="submit"
                                    class="pull-right no-uppercase md-primary"
                                    ng-click="updateCtrl.onUpdateClicked()"
                                    ng-disabled="updateForm.$invalid">
                                <span>Save<i class="fa fa-floppy-o iconed-text"></i></span>
                                <md-tooltip md-delay="200">Updates current report.</md-tooltip>
                            </md-button>
                            <md-button
                                    ng-if="!updateCtrl.isDisabled"
                                    remove-focus
                                    type="submit"
                                    class="pull-right no-uppercase"
                                    ng-click="updateCtrl.onCalculateClicked()"
                                    ng-disabled="updateForm.$invalid">
                                <span>Calculate<i class="fa fa-calculator iconed-text"></i></span>
                                <md-tooltip md-delay="200">Calculates without saving.</md-tooltip>
                            </md-button>
                        </div>
                    </div>
                    <!--<p class="md-warn" ng-show="billingForm.$invalid">Can't submit document with invalid fields</p>-->
                    <hr/>
                    <hoa-comments id="comments" comments="updateCtrl.comments"></hoa-comments>
                </md-card-content>
            </md-card>

        </form>
    </div>
</md-content>